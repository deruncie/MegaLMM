<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MegaLMM • MegaLMM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="MegaLMM">
<meta property="og:description" content="Efficient implementation the MegaLMM model of Runcie et al 2020">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">MegaLMM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/MultiEnvironmentTrial.html">MultiEnvironmentTrial</a>
    </li>
    <li>
      <a href="articles/Running_MegaLMM.html">Running MegaLMM</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<p><strong>MegaLMM</strong> is a package for fitting multi-trait linear mixed models (MvLMMs) with multiple random effects based on the paper available here:</p>
<p>Please treat this as a Beta version and let me know of issues running the functions.</p>
<div class="section level3">
<h3 id="installation">Installation:<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<pre class="{r}"><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'deruncie/MegaLMM'</span><span class="op">)</span></span></code></pre>
<p>Note: the package requires OpenMP which causes problems on a Mac. I was able to get everything to run by following these instructions: <a href="https://mac.r-project.org/openmp/" class="external-link uri">https://mac.r-project.org/openmp/</a> including the addition to <code>~/.R/Makevars</code>. Installing on Unix-like machines and maybe Windows should cause fewer problems.</p>
</div>
<div class="section level3">
<h3 id="introduction">Introduction:<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Please see the vignette <a href="https://github.com/deruncie/MegaLMM/blob/master/vignettes/MultiEnvironmentTrial.Rmd" class="external-link"><code>MultiEnvironmentTrial.Rmd</code></a> for an introduction to using <strong>MegaLMM</strong>. This will apply <strong>MegaLMM</strong> to the analysis of a very incomplete multi-environment trial, and go through many of the key functions in the package</p>
<p>You can simply download the .Rmd file above and run it yourself. If you would like to build the vignette, do:</p>
<pre class="{r}"><code><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'deruncie/MegaLMM'</span>, build_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"--no-resave-data"</span>, <span class="st">"--no-manual"</span><span class="op">)</span>,force <span class="op">=</span> <span class="cn">TRUE</span>,build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
<pre class="{r}"><code><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="st">'MultiEnvironmentTrial'</span>,package<span class="op">=</span><span class="st">'MegaLMM'</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h3>
<p><strong>MegaLMM</strong> implements multivariate linear mixed models of the form:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> XB <span class="sc">+</span> Z_1 U_1 <span class="sc">+</span> Z_2 U_2 <span class="sc">+</span> ... <span class="sc">+</span> E</span></code></pre></div>
<p>where <code>Y</code> is a <code>n x t</code> matrix of observations for <code>n</code> individuals and <code>t</code> traits, <code>X</code> is a design matrix for <code>b</code> fixed effects (including an intercept), <code>Z_1</code> through <code>Z_m</code> are design matrices for <code>m</code> random effects, and <code>E</code> is a <code>n x t</code> matrix of residual errors. The random effects are <code>U_1</code> through <code>U_m</code> are mutually independent of eachother and the residuals, but columns of each <code>U_1</code> matrix can be correlated, and each column vector marginally follows a multivariate normal distribution with a known covariance matrix <code>K_m</code>.</p>
<p>MvLMMs like this are notoriously difficult to fit. We address this by re-paramterizing the MvLMM as a mixed effect factor model:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> F Lambda <span class="sc">+</span> X B_r <span class="sc">+</span> Z_1 U_r1 <span class="sc">+</span> Z_2 U_r2 <span class="sc">+</span> ... <span class="sc">+</span> E_r</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>F <span class="ot">=</span> X B_f <span class="sc">+</span> Z_1 U_f1 <span class="sc">+</span> Z_2 U_f2 <span class="sc">+</span> ... <span class="sc">+</span> E_f</span></code></pre></div>
<p>where <code>F</code> is a <code>n x k</code> matrix of latent factor traits and <code>Lambda</code> is a <code>k x t</code> matrix of factor loadings. This is the model actually fit by <strong>MegaLMM</strong>. For full details, please see the accompanying paper.</p>
<div class="figure">
<img src="articles/Conceptual_model_v4.png" alt=""><p class="caption">Model outline</p>
</div>
<p><strong>Figure 1</strong> from Runcie et al 2021.</p>
<p>The unique aspects of <strong>MegaLMM</strong> relative to other factor models are:</p>
<ol style="list-style-type: decimal">
<li>The residuals of <code>Y</code> after accounting for the factors are not assumed to be iid, but are modeled with independent (across traits) LMMs accounting for both fixed and random effects.</li>
<li>The factors themseleves are also not assumed to be iid, but are modeled with the same LMMs. This highlights the parallel belief that these latent factors represent traits that we just didn’t measure directly.</li>
<li>Each factor is shared by all modeled sources of variation (fixed effects, random effects and residuals), rather than being unique to a particular source.</li>
<li>The factor loadings are strongly regularized so ensure that estimation is efficient. We accomplish this by ordering the factors from most-to-least important using a prior similar to that proposed by <a href="https://pubmed.ncbi.nlm.nih.gov/23049129/" class="external-link">Bhattarchya and Dunson (2011)</a>
</li>
</ol>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing MegaLMM</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Daniel E Runcie <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Daniel E Runcie.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
